<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Proposta de Energia Solar LEVESOL">
    <title>Proposta Comercial | {{ cliente.nome }}</title>
    
    <!-- Fontes Google -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;800&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Ícones (RemixIcon) -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --bg-body-start: #0EA5E9;
            --bg-body-end: #E0F2FE;
            --bg-card: rgba(255, 255, 255, 0.95);
            --bg-card-hover: #FFFFFF; 
            --solar-blue: #0284C7;
            --solar-blue-light: #0EA5E9;
            --solar-blue-dark: #0C4A6E;
            --solar-gold-hex: #f1c40f;
            --solar-red-hex: #e74c3c;
            --solar-gradient: linear-gradient(135deg, #0EA5E9 0%, #0284C7 100%);
            --text-main: #34495e;
            --text-muted: #7f8c8d;
            --success: #27ae60;
            --danger: #e74c3c;
            --glass-border: 1px solid rgba(255, 255, 255, 0.6);
            --shadow-card: 0 10px 30px -5px rgba(14, 165, 233, 0.15);
            
            /* Espaçamentos padronizados */
            --spacing-xs: 10px;
            --spacing-sm: 20px;
            --spacing-md: 30px;
            --spacing-lg: 40px;
            --spacing-xl: 60px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; scroll-behavior: smooth; }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: 
                linear-gradient(rgba(14, 165, 233, 0.85), rgba(224, 242, 254, 0.95)),
                url('https://images.unsplash.com/photo-1509391366360-2e959784a276?q=80&w=2072&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }

        h1, h2, h3, h4 { font-family: 'Outfit', sans-serif; font-weight: 700; color: var(--text-main); }

        /* NAVBAR */
        .navbar {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 1200px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            padding: 12px 30px;
            border-radius: 50px;
            border: var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        .logo-img { height: 50px; width: auto; }
        
        .nav-links { display: flex; gap: 25px; list-style: none; }
        .nav-links a { color: var(--text-muted); text-decoration: none; font-size: 14px; font-weight: 600; transition: 0.3s; }
        .nav-links a:hover { color: var(--solar-blue); }
        .btn-nav { background: var(--solar-gradient); color: #fff; padding: 8px 20px; border-radius: 20px; font-weight: 700; text-decoration: none; box-shadow: 0 4px 15px rgba(2, 132, 199, 0.3); }

        /* SECTIONS */
        .section { padding: var(--spacing-xl) var(--spacing-sm); max-width: 1000px; margin: 0 auto; border-bottom: 1px solid rgba(255,255,255,0.4); }
        .section-title { font-size: 32px; margin-bottom: var(--spacing-lg); color: var(--text-main); border-left: 5px solid var(--solar-blue); padding-left: 15px; }

        /* HERO */
        .hero {
            min-height: 90vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding-top: 100px;
            position: relative;
        }

        .hero-logo {
            max-width: 450px;
            width: 80%;
            height: auto;
            margin-bottom: 30px;
            filter: drop-shadow(0 10px 20px rgba(14, 165, 233, 0.2));
        }

        .hero h1 { font-size: 56px; margin-bottom: 10px; color: #2c3e50; }
        .hero-sub { color: var(--solar-blue); font-size: 18px; letter-spacing: 2px; text-transform: uppercase; margin-bottom: var(--spacing-lg); font-weight: 800; }
        .proposal-id { background: #fff; color: var(--text-muted); padding: 8px 20px; border-radius: 20px; font-size: 14px; margin-bottom: var(--spacing-lg); border: 1px solid #E2E8F0; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); font-weight: 600; }

        /* DADOS */
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md); margin-bottom: var(--spacing-lg); }
        .data-box { background: var(--bg-card); padding: var(--spacing-md); border-radius: 20px; border: var(--glass-border); box-shadow: var(--shadow-card); backdrop-filter: blur(5px); }
        .data-box h3 { color: #2c3e50; margin-bottom: var(--spacing-sm); font-size: 18px; display: flex; align-items: center; gap: 10px; }
        
        .info-row { display: flex; justify-content: space-between; border-bottom: 1px solid #E2E8F0; padding: 12px 0; font-size: 14px; }
        .info-row:last-child { border-bottom: none; }
        .info-label { color: var(--text-muted); }
        .info-val { font-weight: 700; color: var(--text-main); text-align: right; }

        .system-highlight { 
            background: linear-gradient(120deg, #EFF6FF 0%, #DBEAFE 100%);
            border: 2px solid var(--solar-blue-light); 
            padding: var(--spacing-md); 
            border-radius: 20px; 
            display: flex; 
            justify-content: space-around;
            flex-wrap: wrap;
            gap: var(--spacing-sm);
            text-align: center;
            box-shadow: 0 10px 25px -5px rgba(2, 132, 199, 0.15);
        }
        .sys-item h4 { font-size: 36px; color: var(--solar-blue); margin-bottom: 5px; }
        .sys-item span { color: var(--text-muted); font-size: 13px; text-transform: uppercase; font-weight: 600; letter-spacing: 0.5px; }

        /* EQUIPAMENTOS & CHART */
        .equip-list { display: grid; gap: var(--spacing-sm); margin-bottom: var(--spacing-lg); }
        .equip-item { background: #fff; padding: var(--spacing-sm); border-radius: 15px; display: flex; align-items: center; gap: 15px; border-left: 4px solid var(--solar-blue); box-shadow: var(--shadow-card); }
        .equip-icon { color: var(--solar-blue); font-size: 24px; background: #EFF6FF; padding: 10px; border-radius: 10px; }
        
        /* IMAGEM DE FORNECEDORES */
        .suppliers-image-container {
            background: #fff;
            padding: var(--spacing-lg);
            border-radius: 20px;
            margin-top: var(--spacing-lg);
            text-align: center;
            box-shadow: var(--shadow-card);
        }
        .suppliers-image-container h3 {
            color: #2c3e50;
            font-size: 24px;
            margin-bottom: var(--spacing-md);
        }
        .suppliers-image {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
        }

        .finance-hero { text-align: center; margin-bottom: var(--spacing-lg); background: #fff; padding: var(--spacing-lg); border-radius: 30px; box-shadow: var(--shadow-card); border: 1px solid #E0F2FE; }
        .big-price { font-size: 56px; font-weight: 800; color: #2c3e50; margin: 10px 0; letter-spacing: -1px; }
        .price-note { color: var(--text-muted); font-size: 14px; }

        .chart-container { background: #fff; padding: var(--spacing-md); border-radius: 20px; box-shadow: var(--shadow-card); margin-bottom: var(--spacing-lg); height: 400px; position: relative; border: 1px solid #E2E8F0; }

        .payback-highlight { display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-sm); margin-bottom: var(--spacing-lg); }
        .pb-card { background: rgba(255, 255, 255, 0.9); padding: var(--spacing-md); border-radius: 20px; text-align: center; border: 1px solid #E2E8F0; box-shadow: var(--shadow-card); }
        .pb-val { font-size: 36px; font-weight: 800; color: var(--success); }

        .table-container { overflow-x: auto; background: #fff; border-radius: 15px; border: 1px solid #E2E8F0; box-shadow: var(--shadow-card); max-height: 500px; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th { text-align: left; padding: 15px 20px; background: #2c3e50; color: #fff; font-size: 12px; text-transform: uppercase; font-weight: 700; position: sticky; top: 0; }
        td { padding: 15px 20px; border-bottom: 1px solid #F1F5F9; font-size: 14px; color: var(--text-muted); }
        td strong { color: var(--text-main); }
        .positive { color: var(--success); font-weight: 600; }
        .negative { color: var(--danger); font-weight: 600; }
        tr:nth-child(even) { background-color: #f8fafc; }

        .terms-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-sm); }
        .term-box { background: rgba(255,255,255,0.6); padding: var(--spacing-sm); border-radius: 15px; border: 1px solid #fff; }
        .term-title { color: #2c3e50; font-size: 12px; text-transform: uppercase; margin-bottom: 5px; font-weight: 700; }
        .term-val { color: var(--text-main); font-weight: 700; font-size: 18px; }

        .cta-footer { text-align: center; padding: var(--spacing-xl) var(--spacing-sm); background: #fff; margin-top: var(--spacing-xl); border-radius: 40px 40px 0 0; box-shadow: 0 -10px 40px rgba(0,0,0,0.05); }
        .btn-large { 
            background: var(--solar-gradient); color: #fff; padding: var(--spacing-sm) var(--spacing-xl); border-radius: 50px; font-size: 20px; font-weight: 800; text-decoration: none; 
            display: inline-flex; align-items: center; gap: 10px; transition: transform 0.2s;
            box-shadow: 0 10px 25px rgba(2, 132, 199, 0.4);
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .btn-large:hover { transform: translateY(-5px); }

        @media (max-width: 768px) {
            .navbar { bottom: 20px; top: auto; width: 95%; justify-content: center; }
            .nav-links { display: none; }
            .data-grid, .payback-highlight { grid-template-columns: 1fr; }
            .hero h1 { font-size: 42px; }
            .big-price { font-size: 42px; }
            .system-highlight { flex-direction: column; }
            .chart-container { height: 300px; }
        }
    </style>
</head>
<body>

    <!-- NAVBAR -->
    <nav class="navbar">
        <img src="/static/levesol_logo.png" 
             alt="LEVESOL" class="logo-img" 
             onerror="this.style.display='none'; document.getElementById('logo-text').style.display='block'">
        <span id="logo-text" style="display:none; font-weight:bold; color:#2c3e50;">LEVESOL</span>

        <ul class="nav-links">
            <li><a href="#dados">Dados</a></li>
            <li><a href="#equipamentos">Equipamentos</a></li>
            <li><a href="#financeiro">Financeiro</a></li>
            <li><a href="#prazos">Prazos</a></li>
        </ul>
        <a href="#aceitar" class="btn-nav">Aceitar</a>
    </nav>

    <!-- HERO -->
    <section class="hero">
        <div class="proposal-id">PROPOSTA {{ numero_proposta }}</div>
        
        <img src="/static/levesol_logo.png" 
             alt="LEVESOL" class="hero-logo">

        <h1>{{ cliente.nome }}</h1>
        <div class="hero-sub">Energia Solar Fotovoltaica</div>
        <p style="color: var(--text-muted); font-weight: 500;">Transforme sol em economia e patrimônio.</p>
    </section>

    <!-- DADOS -->
    <section class="section" id="dados">
        <h2 class="section-title">Dados da Proposta</h2>
        <div class="data-grid">
            <div class="data-box">
                <h3><i class="ri-user-fill"></i> Cliente</h3>
                <div class="info-row">
                    <span class="info-label">Nome</span>
                    <span class="info-val">{{ cliente.nome }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Cidade</span>
                    <span class="info-val">{{ cliente.cidade }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Endereço</span>
                    <span class="info-val" style="max-width: 60%; text-align: right; font-size:12px;">
                        {{ cliente.endereco }}
                    </span>
                </div>
            </div>
            <div class="data-box">
                <h3><i class="ri-flashlight-fill"></i> Perfil de Consumo</h3>
                <div class="info-row">
                    <span class="info-label">Concessionária</span>
                    <span class="info-val">CPFL</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Fornecimento</span>
                    <span class="info-val">{{ dados_sistema.tipo_fornecimento }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Consumo Médio</span>
                    <span class="info-val">{{ dados_sistema.consumo_atual | format_currency }} kWh</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Valor Médio Conta</span>
                    <span class="info-val">{{ dados_sistema.conta_antes | format_currency }}</span>
                </div>
            </div>
        </div>
        <div class="system-highlight">
            <div class="sys-item">
                <h4>{{ dados_sistema.num_modulos }}</h4>
                <span>Módulos (un)</span>
            </div>
            <div class="sys-item">
                <h4>{{ dados_sistema.potencia_kwp | format_currency }} kWp</h4>
                <span>Potência Total</span>
            </div>
            <div class="sys-item">
                <h4>{{ dados_sistema.area_total | format_currency }} m²</h4>
                <span>Área Necessária</span>
            </div>
            <div class="sys-item">
                <h4>{{ dados_sistema.geracao_mensal | format_currency }} kWh</h4>
                <span>Geração Mensal</span>
            </div>
        </div>
    </section>

    <!-- EQUIPAMENTOS -->
    <section class="section" id="equipamentos">
        <h2 class="section-title">Itens Inclusos & Garantias</h2>
        <div class="equip-list">
            <div class="equip-item">
                <i class="ri-layout-grid-fill equip-icon"></i>
                <div>
                    <strong>{{ dados_sistema.num_modulos }} Módulos Fotovoltaicos 700W</strong>
                    <div style="font-size: 13px; color: var(--text-muted);">RISEN / HONOR / SUNX</div>
                </div>
            </div>
            <div class="equip-item">
                <i class="ri-cpu-line equip-icon"></i>
                <div>
                    <strong>1 Inversor Solar {{ dados_sistema.potencia_inversor }}KW</strong>
                    <div style="font-size: 13px; color: var(--text-muted);">DEYE / GROWATT / SOLIS</div>
                </div>
            </div>
            <div class="equip-item">
                <i class="ri-building-4-line equip-icon"></i>
                <div>
                    <strong>Estrutura Completa para Montagem</strong>
                </div>
            </div>
            <div class="equip-item">
                <i class="ri-shield-check-line equip-icon"></i>
                <div>
                    <strong>Proteção e Cabeamento CA/CC</strong>
                </div>
            </div>
            <div class="equip-item">
                <i class="ri-file-list-3-line equip-icon"></i>
                <div>
                    <strong>Homologação</strong>
                </div>
            </div>
            <div class="equip-item">
                <i class="ri-tools-fill equip-icon"></i>
                <div>
                    <strong>Instalação e Mão de Obra</strong>
                </div>
            </div>
            <div class="equip-item">
                <i class="ri-line-chart-line equip-icon"></i>
                <div>
                    <strong>Monitoramento</strong>
                </div>
            </div>
            <div class="equip-item">
                <i class="ri-truck-line equip-icon"></i>
                <div>
                    <strong>Frete</strong>
                </div>
            </div>
        </div>
        
        <!-- GARANTIAS -->
        <div class="suppliers-image-container">
            <h3>Garantia dos Equipamentos</h3>
            <p style="color: var(--text-main); margin-bottom: var(--spacing-sm); line-height: 1.8;">
                <strong>Inversores:</strong> Garantia de 10 anos contra defeitos de fabricação.<br>
                <strong>Módulos:</strong> Garantia de 12 anos (produto) e 30 anos (eficiência de geração).
            </p>
            <img src="/static/logo_fornecedores.png" 
                 alt="Fornecedores e Garantias" 
                 class="suppliers-image">
        </div>
    </section>

    <!-- FINANCEIRO -->
    <section class="section" id="financeiro">
        <h2 class="section-title">Análise Financeira</h2>
        
        <div class="finance-hero">
            <div style="text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); font-weight: 600;">Investimento Total</div>
            <div class="big-price">{{ dados_sistema.investimento | format_currency }}</div>
            <div class="price-note">*Valor sujeito a alterações após visita técnica</div>
        </div>

        <!-- GRÁFICO DE PAYBACK -->
        <div class="chart-container">
            <canvas id="paybackChart"></canvas>
        </div>

        <div class="payback-highlight">
            <div class="pb-card">
                <div style="color: var(--text-muted); margin-bottom: 10px; font-weight: 600;">Retorno (Payback)</div>
                <div class="pb-val">{{ payback_anos }} Anos</div>
                <div style="font-size: 14px; color: var(--text-muted);">e {{ payback_meses }} meses (estimado)</div>
            </div>
            <div class="pb-card" style="border-color: var(--success); background: #F0FDF4;">
                <div style="color: var(--text-muted); margin-bottom: 10px; font-weight: 600;">Economia Total Acumulada</div>
                <div class="pb-val" style="color: var(--success);">{{ economia_total | format_currency }}</div>
                <div style="font-size: 14px; color: var(--text-muted);">Ao final de {{ dados_payback|length }} anos</div>
            </div>
        </div>

        <!-- TABELA -->
        <h3 style="margin-bottom: var(--spacing-sm); font-size: 18px; color: var(--text-main);">Fluxo de Caixa e Economia (Próximos {{ dados_payback|length }} anos)</h3>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Ano</th>
                        <th>Economia Mensal (Média)</th>
                        <th>Saldo Acumulado (Caixa)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in dados_payback %}
                    <tr>
                        <td><strong>{{ item.ano_real }}</strong></td>
                        <td>{{ item.economia_mensal | format_currency }}</td>
                        <td class="{% if item.amortizacao < 0 %}negative{% else %}positive{% endif %}">
                            {{ item.amortizacao | format_currency }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div style="padding: 15px; font-size: 12px; color: var(--text-muted); text-align: right;">
                *Cálculos baseados em reajuste anual de 5% na tarifa.
            </div>
        </div>
    </section>

    <!-- PRAZOS -->
    <section class="section" id="prazos">
        <h2 class="section-title">Prazos e Validade</h2>
        <div class="terms-grid">
            <div class="term-box">
                <div class="term-title">Validade da Proposta</div>
                <div class="term-val" style="color: var(--solar-blue);">10 Dias</div>
            </div>
            <div class="term-box">
                <div class="term-title">Entrega Equipamentos</div>
                <div class="term-val">30 a 60 Dias</div>
            </div>
            <div class="term-box">
                <div class="term-title">Instalação</div>
                <div class="term-val">7 a 15 Dias</div>
            </div>
            <div class="term-box">
                <div class="term-title">Início Funcionamento</div>
                <div class="term-val">30 a 60 Dias</div>
            </div>
        </div>
        <div style="margin-top: var(--spacing-md); font-size: 13px; color: var(--text-muted);">
            * O prazo de início pode variar dependendo exclusivamente da liberação da concessionária de energia local (CPFL).
        </div>
    </section>

    <!-- CTA -->
    <div class="cta-footer" id="aceitar">
        <h2 style="margin-bottom: 20px; font-size: 36px; color: #0C4A6E;">Pronto para economizar?</h2>
        <p style="margin-bottom: 40px; color: var(--text-muted);">Ao clicar abaixo, você confirma o interesse nesta proposta.</p>
        
        <a href="https://wa.me/{{ cliente.telefone_limpo }}?text=Olá! Aceito a proposta {{ numero_proposta }} para {{ cliente.nome }}" 
           target="_blank" class="btn-large">
            <i class="ri-whatsapp-line"></i> ACEITAR PROPOSTA
        </a>
        
        <div style="margin-top: var(--spacing-xl); border-top: 1px solid #E2E8F0; padding-top: var(--spacing-md);">
            <img src="/static/levesol_logo.png" 
                 alt="LEVESOL" style="height: 60px; width: auto; opacity: 0.9; margin-bottom: 10px;">
            <p style="font-size: 12px; color: var(--text-muted);">
                LEVESOL LTDA - CNPJ 44.075.186/0001-11<br>
                Av. Nossa Senhora de Fátima, 11-15, Bauru - SP
            </p>
        </div>
    </div>

    <!-- SCRIPT DO GRÁFICO -->
    <script>
        const ctx = document.getElementById('paybackChart').getContext('2d');

        const COLOR_RED = '#e74c3c'; 
        const COLOR_GOLD = '#f1c40f';
        const COLOR_TEXT = '#34495e';

        const labels = {{ chart_labels | tojson }};
        const dataValues = {{ chart_values | tojson }};

        const backgroundColors = dataValues.map(value => value < 0 ? COLOR_RED : COLOR_GOLD);

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Saldo Acumulado (R$)',
                    data: dataValues,
                    backgroundColor: backgroundColors,
                    borderWidth: 0,
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    title: {
                        display: true,
                        text: 'Análise de Retorno (Payback) - Saldo Acumulado',
                        color: COLOR_TEXT,
                        font: { size: 18, family: "'Outfit', sans-serif", weight: 'bold' },
                        padding: { bottom: 20 }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) { label += ': '; }
                                if (context.parsed.y !== null) {
                                    label += new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(context.parsed.y);
                                }
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        grid: { color: '#e2e8f0', borderDash: [5, 5] },
                        ticks: {
                            callback: function(value) { return 'R$ ' + value / 1000 + 'k'; },
                            color: COLOR_TEXT
                        }
                    },
                    x: {
                        grid: { display: false },
                        ticks: { color: COLOR_TEXT }
                    }
                }
            }
        });
    </script>
</body>
</html>
